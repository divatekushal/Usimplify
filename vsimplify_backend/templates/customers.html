{% extends "base.html" %}

{% block title %}Customer Management - FinanceFlow{% endblock %}
{% block page_title %}Customer Management{% endblock %}
{% block page_subtitle %}Manage customer relationships and account details{% endblock %}

{% block extra_css %}
<style>
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: #f8fafc;
        color: #374151;
    }

    .page-header {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .search-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: center;
        justify-content: space-between;
    }

    .search-box {
        position: relative;
        flex: 1;
        min-width: 300px;
        max-width: 500px;
    }

    .search-input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 3rem;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.2s ease;
        background-color: #ffffff;
    }

    .search-input:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        font-size: 1.125rem;
    }

    .clear-search {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #6b7280;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        opacity: 0;
        transition: all 0.2s ease;
    }

    .clear-search.show {
        opacity: 1;
    }

    .clear-search:hover {
        background-color: #f3f4f6;
        color: #374151;
    }

    .filter-controls {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .filter-select {
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-weight: 500;
        color: #374151;
        background-color: #ffffff;
        transition: border-color 0.2s ease;
        min-width: 120px;
    }

    .filter-select:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .export-btn {
        background-color: #2563eb;
        color: #ffffff;
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .export-btn:hover {
        background-color: #1d4ed8;
        transform: translateY(-1px);
    }

    .table-container {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        margin-bottom: 2rem;
    }

    .table-header {
        background-color: #f8fafc;
        border-bottom: 1px solid #e5e7eb;
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: between;
        align-items: center;
    }

    .table-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
    }

    .table-stats {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table th {
        background-color: #f8fafc;
        padding: 1rem 1.5rem;
        text-align: left;
        font-weight: 600;
        color: #374151;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
        border-bottom: 2px solid #e5e7eb;
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .data-table th.sortable {
        cursor: pointer;
        transition: background-color 0.2s ease;
        position: relative;
    }

    .data-table th.sortable:hover {
        background-color: #f1f5f9;
    }

    .data-table th.sortable::after {
        content: '↕';
        position: absolute;
        right: 0.5rem;
        color: #9ca3af;
        font-size: 0.75rem;
    }

    .data-table th.sorted-asc::after {
        content: '↑';
        color: #2563eb;
    }

    .data-table th.sorted-desc::after {
        content: '↓';
        color: #2563eb;
    }

    .data-table td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #f3f4f6;
        color: #374151;
        font-size: 0.875rem;
        transition: background-color 0.2s ease;
    }

    .data-table tr:hover td {
        background-color: #f9fafb;
    }

    .data-table tr:last-child td {
        border-bottom: none;
    }

    .sl-number {
        font-weight: 600;
        color: #6b7280;
        width: 60px;
    }

    .customer-name {
        font-weight: 600;
        color: #1f2937;
        min-width: 200px;
    }

    .customer-name .name {
        font-size: 0.875rem;
        margin-bottom: 0.125rem;
    }

    .customer-name .code {
        font-size: 0.75rem;
        color: #6b7280;
        font-weight: 400;
    }

    .ledger-name {
        color: #374151;
        min-width: 180px;
    }

    .amount {
        font-weight: 600;
        text-align: right;
        min-width: 120px;
        font-family: 'Monaco', 'Menlo', monospace;
    }

    .amount.positive {
        color: #059669;
    }

    .amount.negative {
        color: #dc2626;
    }

    .amount.zero {
        color: #6b7280;
    }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    .status-active {
        background-color: #d1fae5;
        color: #065f46;
    }

    .status-inactive {
        background-color: #fee2e2;
        color: #991b1b;
    }

    .pagination-container {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .pagination-info {
        color: #6b7280;
        font-size: 0.875rem;
    }

    .pagination-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .page-btn {
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        background-color: #ffffff;
        color: #374151;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.875rem;
        font-weight: 500;
        min-width: 40px;
        text-align: center;
    }

    .page-btn:hover {
        background-color: #f3f4f6;
        border-color: #9ca3af;
    }

    .page-btn.active {
        background-color: #2563eb;
        border-color: #2563eb;
        color: #ffffff;
    }

    .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .page-btn:disabled:hover {
        background-color: #ffffff;
        border-color: #d1d5db;
    }

    .page-size-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .page-size-select {
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.875rem;
        background-color: #ffffff;
    }

    .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 20;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }

    .loading-overlay.show {
        opacity: 1;
        pointer-events: all;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid #2563eb;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6b7280;
    }

    .empty-state img {
        width: 120px;
        height: 120px;
        opacity: 0.5;
        margin: 0 auto 1rem;
    }

    .empty-state h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .highlight {
        background-color: #fef3c7;
        padding: 0.125rem 0.25rem;
        border-radius: 3px;
        font-weight: 600;
    }

    @media (max-width: 768px) {
        .search-container {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-box {
            min-width: auto;
            max-width: none;
        }
        
        .filter-controls {
            justify-content: center;
        }
        
        .pagination-container {
            flex-direction: column;
            text-align: center;
        }
        
        .data-table {
            font-size: 0.75rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6">
    <!-- Page Header with Search -->
    <div class="page-header">
        <div class="search-container">
            <div class="search-box">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                </div>
                <input type="text" 
                       id="search-input" 
                       class="search-input" 
                       placeholder="Search by customer name, ledger name, or code..."
                       autocomplete="off">
                <button class="clear-search" id="clear-search" title="Clear search">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="filter-controls">
                <select id="status-filter" class="filter-select">
                    <option value="all">All Customers</option>
                    <option value="active">Active Only</option>
                    <option value="inactive">Inactive Only</option>
                </select>
                
                <button class="export-btn" onclick="exportData()">
                    <i class="fas fa-download"></i>
                    Export
                </button>
            </div>
        </div>
    </div>
    
    <!-- Data Table -->
    <div class="table-container">
        <div class="table-header">
            <h3 class="table-title">Customer Details</h3>
            <div class="table-stats" id="table-stats">
                Showing <span id="showing-count">0</span> of <span id="total-count">0</span> customers
            </div>
        </div>
        
        <div style="position: relative; overflow-x: auto;">
            <div class="loading-overlay" id="loading-overlay">
                <div class="loading-spinner"></div>
            </div>
            
            <table class="data-table" id="customers-table">
                <thead>
                    <tr>
                        <th class="sl-number">SL</th>
                        <th class="sortable" data-sort="name">Customer Name</th>
                        <th class="sortable" data-sort="ledger">Ledger Name</th>
                        <th class="sortable amount" data-sort="receivable">Total Receivable</th>
                        <th class="sortable amount" data-sort="receipts">Receipts</th>
                        <th class="sortable amount" data-sort="balance">Balance</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
            
            <!-- Empty State -->
            <div class="empty-state" id="empty-state" style="display: none;">
                <img src="/static/images/not-found.png" alt="No customers found">
                <h3>No customers found</h3>
                <p>Try adjusting your search criteria or filters</p>
            </div>
        </div>
    </div>
    
    <!-- Pagination -->
    <div class="pagination-container">
        <div class="pagination-info" id="pagination-info">
            Showing 1-10 of 0 customers
        </div>
        
        <div class="pagination-controls" id="pagination-controls">
            <button class="page-btn" id="first-page" onclick="goToPage(1)">
                <i class="fas fa-angle-double-left"></i>
            </button>
            <button class="page-btn" id="prev-page" onclick="goToPage(currentPage - 1)">
                <i class="fas fa-angle-left"></i>
            </button>
            
            <div id="page-numbers">
                <!-- Page numbers will be populated by JavaScript -->
            </div>
            
            <button class="page-btn" id="next-page" onclick="goToPage(currentPage + 1)">
                <i class="fas fa-angle-right"></i>
            </button>
            <button class="page-btn" id="last-page" onclick="goToPage(totalPages)">
                <i class="fas fa-angle-double-right"></i>
            </button>
        </div>
        
        <div class="page-size-selector">
            <label for="page-size" style="font-size: 0.875rem; color: #6b7280;">Show:</label>
            <select id="page-size" class="page-size-select" onchange="changePageSize()">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Sample customer data (in production, this would come from API)
    const customersData = [
        { id: 1, name: 'Acme Corporation', code: 'ACM001', ledger: 'Acme Corp - Sales', receivable: 1250000, receipts: 800000, balance: 450000, status: 'active' },
        { id: 2, name: 'Beta Solutions Ltd', code: 'BET002', ledger: 'Beta Solutions - Trade', receivable: 890000, receipts: 890000, balance: 0, status: 'active' },
        { id: 3, name: 'Gamma Industries', code: 'GAM003', ledger: 'Gamma Ind - Manufacturing', receivable: 2100000, receipts: 1500000, balance: 600000, status: 'active' },
        { id: 4, name: 'Delta Enterprises', code: 'DEL004', ledger: 'Delta Ent - Services', receivable: 750000, receipts: 750000, balance: 0, status: 'active' },
        { id: 5, name: 'Epsilon Tech', code: 'EPS005', ledger: 'Epsilon - Technology', receivable: 1800000, receipts: 1200000, balance: 600000, status: 'active' },
        { id: 6, name: 'Zeta Logistics', code: 'ZET006', ledger: 'Zeta - Transport', receivable: 650000, receipts: 400000, balance: 250000, status: 'inactive' },
        { id: 7, name: 'Theta Construction', code: 'THE007', ledger: 'Theta - Construction', receivable: 3200000, receipts: 2800000, balance: 400000, status: 'active' },
        { id: 8, name: 'Iota Marketing', code: 'IOT008', ledger: 'Iota - Marketing', receivable: 420000, receipts: 420000, balance: 0, status: 'active' },
        { id: 9, name: 'Kappa Foods', code: 'KAP009', ledger: 'Kappa - Food Products', receivable: 1100000, receipts: 850000, balance: 250000, status: 'active' },
        { id: 10, name: 'Lambda Textiles', code: 'LAM010', ledger: 'Lambda - Textiles', receivable: 980000, receipts: 780000, balance: 200000, status: 'inactive' },
        { id: 11, name: 'Mu Electronics', code: 'MU011', ledger: 'Mu - Electronics', receivable: 1650000, receipts: 1100000, balance: 550000, status: 'active' },
        { id: 12, name: 'Nu Pharmaceuticals', code: 'NU012', ledger: 'Nu - Pharma', receivable: 2850000, receipts: 2200000, balance: 650000, status: 'active' },
        { id: 13, name: 'Xi Motors', code: 'XI013', ledger: 'Xi - Automotive', receivable: 1920000, receipts: 1920000, balance: 0, status: 'active' },
        { id: 14, name: 'Omicron Services', code: 'OMI014', ledger: 'Omicron - Services', receivable: 380000, receipts: 280000, balance: 100000, status: 'active' },
        { id: 15, name: 'Pi Consultancy', code: 'PI015', ledger: 'Pi - Consulting', receivable: 720000, receipts: 520000, balance: 200000, status: 'inactive' },
        { id: 16, name: 'Rho Chemicals', code: 'RHO016', ledger: 'Rho - Chemicals', receivable: 1450000, receipts: 1000000, balance: 450000, status: 'active' },
        { id: 17, name: 'Sigma Real Estate', code: 'SIG017', ledger: 'Sigma - Real Estate', receivable: 5200000, receipts: 4800000, balance: 400000, status: 'active' },
        { id: 18, name: 'Tau Energy', code: 'TAU018', ledger: 'Tau - Energy', receivable: 3800000, receipts: 3200000, balance: 600000, status: 'active' },
        { id: 19, name: 'Upsilon Retail', code: 'UPS019', ledger: 'Upsilon - Retail', receivable: 890000, receipts: 890000, balance: 0, status: 'active' },
        { id: 20, name: 'Phi Banking', code: 'PHI020', ledger: 'Phi - Financial', receivable: 1200000, receipts: 800000, balance: 400000, status: 'active' },
        { id: 21, name: 'Chi Healthcare', code: 'CHI021', ledger: 'Chi - Healthcare', receivable: 2100000, receipts: 1800000, balance: 300000, status: 'active' },
        { id: 22, name: 'Psi Education', code: 'PSI022', ledger: 'Psi - Education', receivable: 650000, receipts: 500000, balance: 150000, status: 'inactive' },
        { id: 23, name: 'Omega Trading', code: 'OME023', ledger: 'Omega - Trading', receivable: 1750000, receipts: 1400000, balance: 350000, status: 'active' }
    ];
    
    let filteredData = [...customersData];
    let currentPage = 1;
    let pageSize = 10;
    let totalPages = 1;
    let currentSort = { column: null, direction: null };
    let searchTerm = '';
    let statusFilter = 'all';
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        updateTable();
        setupEventListeners();
    });
    
    function setupEventListeners() {
        // Search input
        const searchInput = document.getElementById('search-input');
        const clearSearch = document.getElementById('clear-search');
        
        searchInput.addEventListener('input', function() {
            searchTerm = this.value.toLowerCase();
            clearSearch.classList.toggle('show', searchTerm.length > 0);
            currentPage = 1;
            filterAndUpdateTable();
        });
        
        clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            searchTerm = '';
            this.classList.remove('show');
            currentPage = 1;
            filterAndUpdateTable();
            searchInput.focus();
        });
        
        // Status filter
        document.getElementById('status-filter').addEventListener('change', function() {
            statusFilter = this.value;
            currentPage = 1;
            filterAndUpdateTable();
        });
        
        // Sort headers
        document.querySelectorAll('th.sortable').forEach(header => {
            header.addEventListener('click', function() {
                const column = this.dataset.sort;
                handleSort(column);
            });
        });
    }
    
    function filterAndUpdateTable() {
        showLoading();
        
        setTimeout(() => {
            // Filter data based on search and status
            filteredData = customersData.filter(customer => {
                const matchesSearch = searchTerm === '' || 
                    customer.name.toLowerCase().includes(searchTerm) ||
                    customer.code.toLowerCase().includes(searchTerm) ||
                    customer.ledger.toLowerCase().includes(searchTerm);
                
                const matchesStatus = statusFilter === 'all' || customer.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });
            
            // Apply current sort
            if (currentSort.column) {
                sortData(currentSort.column, currentSort.direction);
            }
            
            updateTable();
            hideLoading();
        }, 300);
    }
    
    function handleSort(column) {
        if (currentSort.column === column) {
            // Toggle direction
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
            // New column
            currentSort.column = column;
            currentSort.direction = 'asc';
        }
        
        // Update header classes
        document.querySelectorAll('th.sortable').forEach(header => {
            header.classList.remove('sorted-asc', 'sorted-desc');
            if (header.dataset.sort === column) {
                header.classList.add(`sorted-${currentSort.direction}`);
            }
        });
        
        sortData(column, currentSort.direction);
        currentPage = 1;
        updateTable();
    }
    
    function sortData(column, direction) {
        filteredData.sort((a, b) => {
            let valueA, valueB;
            
            switch (column) {
                case 'name':
                    valueA = a.name.toLowerCase();
                    valueB = b.name.toLowerCase();
                    break;
                case 'ledger':
                    valueA = a.ledger.toLowerCase();
                    valueB = b.ledger.toLowerCase();
                    break;
                case 'receivable':
                    valueA = a.receivable;
                    valueB = b.receivable;
                    break;
                case 'receipts':
                    valueA = a.receipts;
                    valueB = b.receipts;
                    break;
                case 'balance':
                    valueA = a.balance;
                    valueB = b.balance;
                    break;
                default:
                    return 0;
            }
            
            if (valueA < valueB) return direction === 'asc' ? -1 : 1;
            if (valueA > valueB) return direction === 'asc' ? 1 : -1;
            return 0;
        });
    }
    
    function updateTable() {
        totalPages = Math.ceil(filteredData.length / pageSize);
        if (totalPages === 0) totalPages = 1;
        if (currentPage > totalPages) currentPage = totalPages;
        
        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = startIndex + pageSize;
        const pageData = filteredData.slice(startIndex, endIndex);
        
        renderTable(pageData, startIndex);
        updatePagination();
        updateStats();
    }
    
    // Add this to the renderTable function in customers.html
function renderTable(data, startIndex) {
    const tableBody = document.getElementById('table-body');
    const emptyState = document.getElementById('empty-state');
    
    if (data.length === 0) {
        tableBody.innerHTML = '';
        emptyState.style.display = 'block';
        return;
    }
    
    emptyState.style.display = 'none';
    
    tableBody.innerHTML = data.map((customer, index) => `
        <tr>
            <td class="sl-number">${startIndex + index + 1}</td>
            <td class="customer-name">
                <div class="name">
                    <a href="/customer/${customer.id}" class="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer">
                        ${highlightText(customer.name)}
                    </a>
                </div>
                <div class="code">${highlightText(customer.code)}</div>
            </td>
            <!-- rest remains same -->
            <td class="ledger-name">${highlightText(customer.ledger)}</td>
            <td class="amount ${getAmountClass(customer.receivable)}">${formatCurrency(customer.receivable)}</td>
            <td class="amount ${getAmountClass(customer.receipts)}">${formatCurrency(customer.receipts)}</td>
            <td class="amount ${getAmountClass(customer.balance)}">${formatCurrency(customer.balance)}</td>
            <td>
                <span class="status-badge status-${customer.status}">
                    ${customer.status}
                </span>
            </td>
        </tr>
    `).join('');
}

    
    function highlightText(text) {
        if (!searchTerm) return text;
        
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, '<span class="highlight">$1</span>');
    }
    
    function formatCurrency(amount) {
        return '₹' + amount.toLocaleString('en-IN');
    }
    
    function getAmountClass(amount) {
        if (amount > 0) return 'positive';
        if (amount < 0) return 'negative';
        return 'zero';
    }
    
    function updatePagination() {
        const paginationInfo = document.getElementById('pagination-info');
        const pageNumbers = document.getElementById('page-numbers');
        
        const startIndex = (currentPage - 1) * pageSize + 1;
        const endIndex = Math.min(currentPage * pageSize, filteredData.length);
        
        paginationInfo.textContent = `Showing ${startIndex}-${endIndex} of ${filteredData.length} customers`;
        
        // Update navigation buttons
        document.getElementById('first-page').disabled = currentPage === 1;
        document.getElementById('prev-page').disabled = currentPage === 1;
        document.getElementById('next-page').disabled = currentPage === totalPages;
        document.getElementById('last-page').disabled = currentPage === totalPages;
        
        // Generate page numbers
        pageNumbers.innerHTML = generatePageNumbers();
    }
    
    function generatePageNumbers() {
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        let html = '';
        
        for (let i = startPage; i <= endPage; i++) {
            html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
        }
        
        return html;
    }
    
    function updateStats() {
        document.getElementById('showing-count').textContent = filteredData.length;
        document.getElementById('total-count').textContent = customersData.length;
    }
    
    function goToPage(page) {
        if (page >= 1 && page <= totalPages && page !== currentPage) {
            currentPage = page;
            updateTable();
        }
    }
    
    function changePageSize() {
        pageSize = parseInt(document.getElementById('page-size').value);
        currentPage = 1;
        updateTable();
    }
    
    function showLoading() {
        document.getElementById('loading-overlay').classList.add('show');
    }
    
    function hideLoading() {
        document.getElementById('loading-overlay').classList.remove('show');
    }
    
    function exportData() {
        // Create CSV content
        const headers = ['SL', 'Customer Name', 'Customer Code', 'Ledger Name', 'Total Receivable', 'Receipts', 'Balance', 'Status'];
        const csvContent = [
            headers.join(','),
            ...filteredData.map((customer, index) => [
                index + 1,
                `"${customer.name}"`,
                customer.code,
                `"${customer.ledger}"`,
                customer.receivable,
                customer.receipts,
                customer.balance,
                customer.status
            ].join(','))
        ].join('\n');
        
        // Download CSV file
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `customers_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }
</script>
{% endblock %}
